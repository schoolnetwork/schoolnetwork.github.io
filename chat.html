<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SchoolNet Chat</title>
    <link rel="stylesheet" href="./css/chat.css" />
  </head>
  <body>
    <div class="chat-container">
      <h1>Welcome to SchoolNet Chat</h1>

      <!-- Username input -->
      <input type="text" id="username" placeholder="Enter your username" />

      <!-- Messages Display -->
      <div id="messages-container">
        <!-- Chat messages will show here -->
      </div>

      <!-- Message Input and Send Button -->
      <div id="input-container">
        <input type="text" id="message" placeholder="Type your message" />
        <button id="sendMessage">Send</button>
      </div>

      <!-- Owner Panel (hidden initially) -->
      <div id="ownerPanel" style="display: none">
        <h3>Owner Panel</h3>
        <input type="password" id="ownerPassword" placeholder="Enter password" />
        <button id="deleteMessageBtn">Delete Message</button>
      </div>

      <!-- Back to Home Button -->
      <button id="backHome" onclick="window.location.href='/index.html'">Back Home</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      // Send message event
      document.getElementById('sendMessage').addEventListener('click', function (event) {
        event.preventDefault(); // Prevent page reload

        const username = document.getElementById('username').value;
        const message = document.getElementById('message').value;

        if (username && message) {
          // Emit message to server
          socket.emit('chat message', { user: username, msg: message });

          // Clear the message input
          document.getElementById('message').value = '';
        }
      });

      // Listen for incoming messages
      socket.on('chat message', function (msgData) {
        const messageContainer = document.createElement('div');
        messageContainer.classList.add('message');
        messageContainer.innerHTML = `<strong>${msgData.user}:</strong> ${msgData.msg}`;
        document.getElementById('messages-container').appendChild(messageContainer);
        // Scroll to the bottom to show the latest message
        document.getElementById('messages-container').scrollTop = document.getElementById('messages-container').scrollHeight;
      });

      // Owner panel functionality (for owner password)
      document.getElementById('ownerPassword').addEventListener('input', function () {
        const password = document.getElementById('ownerPassword').value;
        if (password === 'owneriscool') {
          document.getElementById('ownerPanel').style.display = 'block';
        } else {
          document.getElementById('ownerPanel').style.display = 'none';
        }
      });

      // Message delete (for owner only)
      document.getElementById('deleteMessageBtn').addEventListener('click', function () {
        alert('Message deleted! (Implement message deletion logic here)');
      });
    </script>
  </body>
</html>
